



# 리팩토링









# #1 맛보기 예제



## 원래의 프로그램

- 예제는 비디오 대여점에서 고객의 대여료 내역을 계산하고 출력하는 간단한 프로그램
- 프로그램이 당장은 문제가 없을지 몰라도 나중엔 사용자가 요구한 기능을 수정하기 힘들어서 애먹을 수 있다. 이 상황이 바로 리팩토링 해야 하는 시점이다.
- 프로그램에 기능을 추가해야 하는데 코드 구조가 조잡해서 그 기능을 추가하기 힘들다면, 우선 리팩토링을 실시해서 기능을 추가하기 쉽게 만든 후 그 기능을 추가하자.



## 리팩토링 첫 단계

- 리팩토링할 코드 부분에 대한 신뢰도 높은 각종 테스트를 작성한다.
- 적절한 테스트코드를 작성하는 것은 리팩토링의 기본이다.



## statement 메서드 분해와 기능 재분재

## 가격 책정 부분의 조건문을 재정의로 교체

## 고찰

- 가장 중요한 교훈은 '간단한 수정 -> 테스트'를 리듬처럼 반복하는 것이다. 이 리듬을 지킬 때만이 리팩토링을 빠르고 안정적으로 완료할 수 있다.



# #2 리팩토링 개론

## 리팩토링은 무엇인가

- 리팩토링의 목적은 소프트웨어를 더 이해하기 쉽고 수정하기 쉽게 만드는 것이다.
- 리팩토링을 수행하면 겉으로 드러나는 기능에 거의 또는 아예 영향을 주지 않은 채 소프트웨어의 각종 기능을 변경할 수 있다.
- 리팩토링은 겉으로 드러나는 소프트웨어 기능에 영향을 주지 않는다.

`모자 두 개`

- 소프트웨어 개발에서 기능을 추가할 땐 코드를 수정하지 말고 기능만 추가해야 한다. 진행상태를 파악하려면 테스트를 추가하고 그 테스트들이 제대로 되는지 알아내면 된다.
- 리팩토링할때는 코드를 추가하지 말고 코드 구조 개선만 해야 한다.
- 인터페이스가 변경되어 그에 맞게 코드를 고치는 것이 불가피할 땐 테스트만 변경해야 한다.
- 각자 단계를 나눠서 본인이 현재 하고 있는 작업의 일관성을 유지해야 한다.



## 리팩토링은 왜 해야 하나

`소프트웨어 설계가 개선되니까`

- 리팩토링을 실시하지 않으면 프로그램 설계는 점점 노후된다.
- 코드의 설계를 파악하기 힘들어질수록 설계를 보수하기도 힘들어지고 악순환이 반복된다.
- 코드의 처음 설계 구조를 유지하려면 정기적으로 리팩토링을 실히해야 한다.
- 설계를 개선하는 주요 비법중 하나는 바로 그런 중복 코드를 없애는 것이다.
- 중복 코드 제거는 깔끔한 설계의 필수 요건이다.



`소프트웨어를 이해하기가 더 쉬어지니까`

- 개발자가 프로그램을 제대로 실행되게 만드는데만 집착하고 수정이 어렵고 이해하기 어렵게 만드는 것은 문제가 된다.
- 코드를 쉽게 만드는 것은 중요하다.



`버그를 찾기가 쉬워지니까`

- 코드를 파악하기 쉬우면 버그 발견도 쉬워진다.
- 리팩토링을 통해 빈틈없는 코드를 훨씬 효과적으로 작성할 수 있다.



`프로그래밍 속도가 빨라지니까`

- 깔끔한 설계야말로 소프트웨어 개발 속도를 높이기 위한 핵심이다.
- 리팩토링을 통해 깔끔해지므로 소프트웨어 개발이 더 빨라진다.



## 리팩토링은 어떨 때 필요한가

- 리팩토링은 작정해서 하는게 아니라 뭔가 다른 걸 해야 겠는데 리팩토링을 실시하면 그작업이 쉬워지기 때문에 하는 것이다.

`같은 작업의 삼진 아웃 때`

- 비슷한 작업을 세번째 하게 되면 그때 리팩토링을 실시한다.

`기능을 추가할 때`

- 리팩토링을 통해 코드를 이해하기 쉽게 만드는 과정에서 해당 코드에 대해 더 깊게 이해할 수 있다.
- 설계가 지저분해서 어떤 기능을 추가하기 힘들 때 리팩토링 한다.

`버그를 수정할 때`

- 버그를 수정할 땐 주로 코드를 이해하기 쉽게 만드려고 리팩토링 한다.
- 코드의 기능을 파악하려다 이해하기 쉽게 만들려고 리팩토링을 실시한다.

`코드를 검수할 때`

- 코드 검수는 명료한 코드를 작성하기 위해서 꼭 필요하다.
- 코드 검수를 통해 개발 팀원 모두가 코드를 파악하게 되고 선익 개발자가 경험이 적은 개발자에게 지식을 전수하는 결과도 얻게 된다.



### 리팩토링의 효용성

- 과거의 판단이 현재의 기준으로 불합리하다는 사실을 발견했다면 그 판단을 수정해야 한다. 그래야 현재 작업을 할 수 있다.
- 프로그램은 다음 4가지 상황일 때 수정하기 힘들어진다.
  - 코드를 알아보기 힘들 때
  - 중복된 로직이 들어 있을 때
  - 추가 기능을 넣어야 해서 실행중인 코드를 변경해야 할 때
  - 조건문 구조가 복잡할 때
- 코드를 알아보기 쉽고 기존 기능을 건드릴 필요 없이 조건문 구조가 최대한 간결하게끔 작성해야 한다.
- 리팩토링은 실행 중인 프로그램을 기능을 바꾸는 작업이 아니고 신속한 개발 공정을 가능하게 하는 이런 성질을 가중하면서 가치를 높이는 것이다.



## 팀장에게 어떻게 말을 꺼내나

- 품질에 큰 비중을 두는 팀장이면 품질적인 면을 부각시켜 말해야 한다.
- 일정이 빠듯할 경우에는 리팩토링 얘길 꺼내지 말고 몰래 실시하자.
- 소프트웨어 개발자의 임무는 전문가로서 효과적인 소프트웨어를 최대한 신속히 제작하기만 하면 된다.



### 인다이렉션과 리팩토링

- 리팩토링은 방대한 객체와 장황한 메서드를 잘게 쪼개는 경향이 있다.
- 인다이렉션은 양날의 검!
- 인다이렉션을 사용하는것은 가능하면 자제하면 좋지만 아래와 같은 장점이 있다.

`로직을 공유`

- 두 위치에서 호출되는 하위 메서드나 모든 하위클래스가 공유하는 상위클래스의 메서드 등이 있다. 이런 식으로 하나의 로직을 여러 곳에서 공유할 수 있다.

`의도와 구현부를 따로 나타냄`

- 클래스명과 메서드 명을 정해서 의도한 바를 드러낼 수 있고 클래스나 메서드 내부 코드를 통해 그 의도를 어떻게 구현했는지 보여줄 수 있다.

`수정 부분을 분리`

- 한 객체를 두 위치에 사용했는데 두 경우 한 상황에 대해 동작을 수정해야 할 때 그 객체를 수정하면 두 상황이 모두 변경될 위험이 있다.
- 이런 경우 하위클래스를 만들고 변하는 경우에 참조하게 만들자.

`조건문을 코드화`

- 조건문을 메시지로 바꾸면 중복 코드가 줄어들어 명료해지며 동시에 유연성도 높아진다.

  

## 리팩토링 관련 문제들



