# github

- https://github.com/javacafe-project



# #1 검색 시스템 이해하기

## 검색 시스템의 이해

### 검색 시스템이란?

- 검색엔진은 광활한 웹에서 정보를 수집해 검색 결과를 제공하는 프로그램
- 검색시스템은 대용량 데이터를 기반으로 신뢰성 있는 검색 결과를 제공하기 위해 검색엔진을 기반으로 구축된 시스템
- 검색서비스는 검색 시스템을 활용해 검색 결과를 서비스로 제공
- 서비스 > 시스템 > 엔진
- 엘라는 검색엔진

### 검색 시스템의 구성 요소

#### 수집기

- 웹사이트, 블로그, 카페 등 웹에서 필요한 정보를 수집하는 프로그램 

#### 스토리지

- 데이터베이스에서 데이터를 저장하는 물리적인 저장소

#### 색인기

- 검색엔진이 사용자의 질의와 일치하는 정보를 찾으려면 수집되 ㄴ데이터를 검색 가능한 구조로 가공하고 저장해야 함 그 역할을 하는 것이 색인기임
- 다양한 형태소 분석기를 조합해 정보에서 의미가 있는 용어를 추출하고 검색에 유리한 역색인 구조로 데이터를 저장함

#### 검색기

- 사용자의 질의를 입력받아 색인기에서 저장한 역색인 구조에서 일치하는 문서를 찾아 결과로 반환함. 질의와 문서가 일치하는지도 유사도 기반의 검색 순위 알고리즘으로 판단함
- 형태소 분석기에 따라 검색 품질이 달라짐

### rdb와의 차이점

- rdb는 sql문을 이용해 원하는 정보의 검색이 가능한데 텍스트 매칭을 통한 단순한 검색만 가능함 텍스트를 여러 개의 동의어나 유의어를 활용한 검색은 불가능함
- 검색엔진은 rdb에서 불가능한 비정형 데이터를 색인하고 검색할 수 있음
- 형태소 분석을 통해 사람이 구사하는 자연어으 ㅣ처리가 가능해지고 역색인 구조를 바탕으로 빠른 검색 속도를 보장함



| 엘라      | rdb          |
| --------- | ------------ |
| 샤드      | 파티션       |
| 타입      | 테이블       |
| 문서      | 행           |
| 필드      | 열           |
| 매핑      | 스키마       |
| query dsl | sql          |
| 인덱스    | 데이터베이스 |



| 엘라 HTTP 메서드 | 기능               | RDB 문법       |
| ---------------- | ------------------ | -------------- |
| GET              | 조회               | SELECT         |
| PUT              | 생성               | INSERT         |
| POST             | 업데이트 조회      | UPDATE, SELECT |
| DELETE           | 삭제               | DELETE         |
| HEAD             | 인덱스의 정보 확인 | -              |



- curl -X(메섣) http://host:port/(인덱스)/(타입)/(문서 id) -d '{json data}' 가 간단한 요청 구조
- 기존 rdb에서 대소문자 검색이 불가능하던것을 엘라는 가능하게 해줌
- 비정형 데이터도 검색이 가능한것이 강점
- rdb는 스키마를 미리 정의해야만 데이터 저장과 조회가 가능하지만 엘라는 구조화되지 않은 데이터까지 스스로 분석해 자동으로 필드를 생성하고 저장함

## 검색 시스템과 엘라스틱 서치

- nosql의 한 종류
- 분산처리를 통해 실시간에 준하는 빠른 검색이 가능함
- 비정형 데이터도 검색 가능
- 전문 검색과 구조 검색 모두 지원
- 기본적으로 검색 엔진이지만 mongo나 hbase처럼 대용량 스토리지로도 활용 가능

### 엘라가 강력한 이유

- 오픈소스: 루씬을 기반으로 개발된 오픈소스 검색 엔진
- 전문 검색: 고차원적인 전문 검색이 가능함 전문검색이란 내용 전체를 색인해서 특정 단어가 포함된 문서를 검색하는것을 말함 기존 rdb는 전문 검색에 적합하지 않지만 엘라는 다양한 기능별 언어별 플러그인을 조합해 빠르게 검색 가능
- 통계 분석: 비정형 로그 데이터를 수집하고 한곳에 모아 통계 분석 가능 엘라와 키바나를 연결하면 실시간으로 쌓이는 로그를 시각화하고 분석 가능
- 스키마리스: 다양한 형태의 문서도 자동으로 색인하고 검색 가능
- restful api: 엘라는 api를 제공하고 json 타입을 사용함 <- 이기종 플랫폼 지원 가능
- 멀티 테넌시: 서로 상이한 인덱스일지라도 검색할 필드명만 같으면 여러개의 인덱스를 한번에 조회 가능
- document-oriented: 여러 계층형 데이터를 json 형식의 구조화된 문서로 인덱스에 저장 가능 & 쉽게 쿼리 가능
- 역색인: 루씬 기반의 검색 엔진. mongo, 칸산드라는 역색인 지원 x 역색인은 매우 큰 장점
- 확장성과 가용성: 샤드로 분리하고 인덱스를 만들때마다 샤드의 수를 조절 가능함

### 엘라스틱서치의 약점

- 실시간이 아니고 일반적으로 색인된 데이터는 1초 뒤에나 검색이 가능함 내부적으로 커밋과 플러시 같은 복잡한 과정을 거치기 때문에 실시간이 아님
- 트랜잭션과 롤백 기능이 없음 최악의 경우 데이터 손실의 위험이 있음
- 데이터의 업데이트를 제공하지 않음 업데이트가 필요하다면 지우고 다시 씀 <- 비용이 크지만 불변이라는 이득도 있어서 큰 단점은 아님



## 실습 환경 구축

- 도커로 설치함



```

curl localhost:9200

{
  "name" : "DcYVRdz",
  "cluster_name" : "docker-cluster",
  "cluster_uuid" : "DsypX1ktQcCIUW7xCrR8FA",
  "version" : {
    "number" : "6.5.0",
    "build_flavor" : "default",
    "build_type" : "tar",
    "build_hash" : "816e6f6",
    "build_date" : "2018-11-09T18:58:36.352602Z",
    "build_snapshot" : false,
    "lucene_version" : "7.5.0",
    "minimum_wire_compatibility_version" : "5.6.0",
    "minimum_index_compatibility_version" : "5.0.0"
  },
  "tagline" : "You Know, for Search"
}
```

- cluster_name은 엘라스틱서치 클러스터를 구분하는 중요한 속성임 
- 주요 설정 항목
  - cluster.name : 클러스터 명
  - node.name : 노드 명 설정안하면 알아서 생성
  - path.data : 인덱스 경로 설정안하면 엘라스틱 서치 하위의 data 디렉터리에 인덱스 생성
  - path.logs : 로그 기본경로는 /path/to/logs
  - path.repo : 엘라스틱서치 인덱스를 백업하기 위한 스냅숏의 겨올 지정
  - network.host : 특정 ip만 접근하도록 허용 가능 
  - http.port : 서버에 접근할 수 있는 포트 기본값은 9200
  - transport.tcp.port : 클라이언트가 접근할 수 있는 tcp 기본값은 9300
  - discovery.zen.ping.unicast.hosts: 노드가 여러개인 경우 유니캐스트로 활성화된 다른 서버를 찾음 
  - discovery.zen.minimum_master_nodes: 마스터 노드의 선출이 되는 노드의 수를 지정함.
  - node.master: 마스터 노드로 동작 여부 지정
  - node.data: 데이터 노드로 동작 여부 지정
- 













