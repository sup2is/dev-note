



# Database Internals









데이터베이스 관리 시스템의 주 목적은 데이터를 안정적으로 저장하고 사용자에게 제공하는 것이다.



# #1 소개 및 개요

## DBMS 구조

- 표준화된 DBMS 구조란 존재하지 않는다. 모든 데이터베이스 구조는 다르고 내부 컴포넌트의 경계를 명확히 나누고 정의하기 어렵다.
- DBMS는 클라이언트/서버 모델을 기반으로 한다.
- 클라이언트의 요청은 트랜스포트 서브시스템을 통해 전달된다. 요청은 쿼리 형태이고 트랜스포트 서브시스템은 데이터 클러스터 노드 사이의 통신에도 사용된다.
- 트랜스포트 서브시스템은 쿼리를 쿼리 프로세서에게 전달한다. 쿼리 프로세서는 쿼리를 해석 분석 및 검증한다. 쿼리의 의미를 파악한 뒤에 액세스 제어를 진행할 수 있다.
- 분석된 쿼리는 쿼리 옵티마이저에게 전달된다. 쿼리에서 논리적으로 불가능한 부분과 중복을 제거한 뒤에 내부 데이터 통계 등을 기반으로 가장 효율적인 쿼리 실행 계획을 생성한다. 그외에도 인덱스 순서 선택, 카디널리티 예측, 액세스 메서드 선택등의 최적화 단계를 처리한다.
- 쿼리는 일반적으로 실행 계획 형태로 표현되고 다양한 쿼리 실행계획이 있을 수 있으며 옵티마이저는 이 가운데 가장 효율적인 실행 계획을 선택한다.
- 선택된 실행 계획은 로컬 및 원격 실행의 결과를 결합하는 실행 엔진이 수행한다.
- 로컬 쿼리는 스토리지 엔진이 수행한다. 스토리지 엔진은 다음과 같이 명확한 역할을 담당하는 컴포넌트로 구성되어 있다.
  - 트랜잭션 매니저: 트랜잭션을 스케줄링하고 데이터베이스 상태의 논리적 일관성을 보장한다.
  - 잠금 매니저: 트랜잭션에서 접근하는 데이터베이스 객체에 대한 잠금을 제어한다. 동시 수행 작업이 물리적 데이터 무결성을 침해하지 않도록 제어한다.
  - 액세스 메서드: 디스크에 저장된 데이터에 대한 접근 및 저장 방식을 정의한다. 힙 파일과 B-트리 또는 LSM트리 등의 자료구조를 사용한다.
  - 버퍼 매니저: 데이터 페이지를 메모리에 캐시한다.
  - 복구 매니저: 로그를 유지 관리하고 장애 발생시 시스템을 복구한다.
- 트랜잭션과 잠금 매너지는 동시성을 제어한다. 

## 인메모리 DBMS 대 디스크 기반 DBMS

- 인메모리 DBMS는 메모리에 데이터를 저장하고 디스크는 복구와 로그 저장 용도로 사용한다.
- 디스크 기반 DBMS는 데이터를 디스크에 저장하고 메모리는 캐시 용도로 사용한다.
- 메모리는 디스크보다 훨씬 더 빠르게 데이터에 접근하지만 RAM은 디스크보다 가격이 비싸다.
- 인메모리 DBMS는 디스크 기반 데이터베이스와 비교해 기본 저장 매체뿐만 아니라 내부 자료 구조와 설계 및 최적화 방식도 모두 다르다.
- 메모리를 주 저장 매체로 사용하는 이유는 성능과 상대적으로 낮은 데이터 접근 비용, 세밀한 접근 단위 때문이다.
- 인메모리 DBMS의 가장 큰 단점은 RAM의 휘발성과 높은 가격이다.
- 디스크는 메모리보다 유지관리 측면에서 더 간단하고 비용이 낮다.
- 비휘발성 램 기술이 더 대중화되면 이런 상황은 뒤바뀔 수 있다.

### 인메모리 데이터베이스의 지속성

- 인메모리 DBMS는 데이터의 지속성을 보장하고 데이터 손실을 방지하기 위해 데이터를 디스크에 백업한다.
- 모든 작업은 로그 파일에 작업 내용을 순차적으로 기록해야 완료된다.
- 인메모리 시스템에서는 시스템 시작과 복구 시 모든 로그를 재수행하지 않기 위해 백업본을 유지하고 백업본은 디스크 기반 자료구조에 순서대로 저장하는데 일반적으로 수정 내용은 비동기적으로 갱신하며 I/O 작업을 최소화하기 위해 배치 단위로 백업한다.
- 로그 레코드는 일반적으로 배치 단위로 백업한다. 배치 작업이 완료되면 백업본은 특정 시점의 데이터베이스 스냅숏이기 때문에 이 시점 이전의 로그는 삭제해도 된다. 이러한 작업을 가리켜 체크포인트를 남긴다고 표현한다.
- 클라이언트의 요청을 블로킹하지 않고 디스크에 저장된 백업본을 최신 로그 데이터와 동기화하면 복구 시간을 단축할 수 있다.
- 메모리는 포인터를 사용해 비교적으로 빠르게 참조할 수 있고 랜덤 메모리 접근 속도는 랜덤 디스크 접근 보다 월등히 빠르다.

## 칼럼형 DBMS 대 로우형 DBMS

- 대부분의 데이터베이스는 열과 행으로 구성된 테이블에 데이터 레코드를 저장한다.
- 사용자 정보 테이블의 모든 사용자 이름은 같은 형식으로 같은 칼럼에 저장하고 논리적으로 같은 레코드에 속하는 값의 집합을 로우라고 부른다.
- 칼럼 저장 방식은 테이블을 수직 분할하고 로우 저장 방식은 수평 분할한다.
- MySQL과 PostgreSQL 등 대부분의 전통적인 관계형 데이터베이스는 로우형 DBMS다.
- MonetDB C-Store는 선구적인 칼럼형 오픈소스 데이터베이스다.

### 로우형 데이터 레이아웃

- 로우형 DBMS는 데이터 레코드를 로우 형식으로 저장한다.
- 이 방식은 여러 필드의 값일 고유 식별 키로 구분할 수 있는 레코드 형식에 적합하다.
- 특정 사용자의 모든 필드는 일반적으로 함께 요청되는 경우가 많다.
- 레코드를 생성할 때에도 레코드의 모든 필드를 함께 쓴다.
- 로우형 DBMS는 한 개의 로우씩 접근하는 경우 적합하다. 로우 단위로 저장하면 공간 지역성을 극대화할 수 있다.
- 특정 사용자의 모든 정보를 읽을 때는 효율적이지만 여러 사용자의 특정 필드를 읽을 때는 비효율적이다.



### 칼럼형 데이터 레이아웃

### 차이점과 최적화 기법

### 와이드 칼럼 스토어

## 데이터 파일과 인덱스 파일

### 데이터 파일

### 인덱스 파일

### 기본 인덱스를 통한 간접 참조

## 버퍼링과 불변성, 순서화

## 요약

